<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>TMS Motor Threshold Estimation</title>
        <style type="text/css">

            /* W3.CSS 4.15 December 2020 by Jan Egil and Borge Refsnes */
            html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}
            /* Extract from normalize.css by Nicolas Gallagher and Jonathan Neal git.io/normalize */
            html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}
            article,aside,details,figcaption,figure,footer,header,main,menu,nav,section{display:block}summary{display:list-item}
            audio,canvas,progress,video{display:inline-block}progress{vertical-align:baseline}
            audio:not([controls]){display:none;height:0}[hidden],template{display:none}
            a{background-color:transparent}a:active,a:hover{outline-width:0}
            abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}
            b,strong{font-weight:bolder}dfn{font-style:italic}mark{background:#ff0;color:#000}
            small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
            sub{bottom:-0.25em}sup{top:-0.5em}figure{margin:1em 40px}img{border-style:none}
            code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}hr{box-sizing:content-box;height:0;overflow:visible}
            button,input,select,textarea,optgroup{font:inherit;margin:0}optgroup{font-weight:bold}
            button,input{overflow:visible}button,select{text-transform:none}
            button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button}
            button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{border-style:none;padding:0}
            button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring{outline:1px dotted ButtonText}
            fieldset{border:1px solid #c0c0c0;margin:0 2px;padding:.35em .625em .75em}
            legend{color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}
            [type=checkbox],[type=radio]{padding:0}
            [type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}
            [type=search]{-webkit-appearance:textfield;outline-offset:-2px}
            [type=search]::-webkit-search-decoration{-webkit-appearance:none}
            ::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}
            /* End extract */
            html,body{font-family:Verdana,sans-serif;font-size:15px;line-height:1.5}html{overflow-x:hidden}
            h1{font-size:36px}h2{font-size:30px}h3{font-size:24px}h4{font-size:20px}h5{font-size:18px}h6{font-size:16px}
            .w3-serif{font-family:serif}.w3-sans-serif{font-family:sans-serif}.w3-cursive{font-family:cursive}.w3-monospace{font-family:monospace}
            h1,h2,h3,h4,h5,h6{font-family:"Segoe UI",Arial,sans-serif;font-weight:400;margin:10px 0}.w3-wide{letter-spacing:4px}
            hr{border:0;border-top:1px solid #eee;margin:20px 0}
            .w3-image{max-width:100%;height:auto}img{vertical-align:middle}a{color:inherit}
            .w3-table,.w3-table-all{border-collapse:collapse;border-spacing:0;width:100%;display:table}.w3-table-all{border:1px solid #ccc}
            .w3-bordered tr,.w3-table-all tr{border-bottom:1px solid #ddd}.w3-striped tbody tr:nth-child(even){background-color:#f1f1f1}
            .w3-table-all tr:nth-child(odd){background-color:#fff}.w3-table-all tr:nth-child(even){background-color:#f1f1f1}
            .w3-hoverable tbody tr:hover,.w3-ul.w3-hoverable li:hover{background-color:#ccc}.w3-centered tr th,.w3-centered tr td{text-align:center}
            .w3-table td,.w3-table th,.w3-table-all td,.w3-table-all th{padding:8px 8px;display:table-cell;text-align:left;vertical-align:top}
            .w3-table th:first-child,.w3-table td:first-child,.w3-table-all th:first-child,.w3-table-all td:first-child{padding-left:16px}
            .w3-btn,.w3-button{border:none;display:inline-block;padding:8px 16px;vertical-align:middle;overflow:hidden;text-decoration:none;color:inherit;background-color:inherit;text-align:center;cursor:pointer;white-space:nowrap}
            .w3-btn:hover{box-shadow:0 8px 16px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19)}
            .w3-btn,.w3-button{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}   
            .w3-disabled,.w3-btn:disabled,.w3-button:disabled{cursor:not-allowed;opacity:0.3}.w3-disabled *,:disabled *{pointer-events:none}
            .w3-btn.w3-disabled:hover,.w3-btn:disabled:hover{box-shadow:none}
            .w3-badge,.w3-tag{background-color:#000;color:#fff;display:inline-block;padding-left:8px;padding-right:8px;text-align:center}.w3-badge{border-radius:50%}
            .w3-ul{list-style-type:none;padding:0;margin:0}.w3-ul li{padding:8px 16px;border-bottom:1px solid #ddd}.w3-ul li:last-child{border-bottom:none}
            .w3-tooltip,.w3-display-container{position:relative}.w3-tooltip .w3-text{display:none}.w3-tooltip:hover .w3-text{display:inline-block}
            .w3-ripple:active{opacity:0.5}.w3-ripple{transition:opacity 0s}
            .w3-input{padding:8px;display:block;border:none;border-bottom:1px solid #ccc;width:100%}
            .w3-select{padding:9px 0;width:100%;border:none;border-bottom:1px solid #ccc}
            .w3-dropdown-click,.w3-dropdown-hover{position:relative;display:inline-block;cursor:pointer}
            .w3-dropdown-hover:hover .w3-dropdown-content{display:block}
            .w3-dropdown-hover:first-child,.w3-dropdown-click:hover{background-color:#ccc;color:#000}
            .w3-dropdown-hover:hover > .w3-button:first-child,.w3-dropdown-click:hover > .w3-button:first-child{background-color:#ccc;color:#000}
            .w3-dropdown-content{cursor:auto;color:#000;background-color:#fff;display:none;position:absolute;min-width:160px;margin:0;padding:0;z-index:1}
            .w3-check,.w3-radio{width:24px;height:24px;position:relative;top:6px}
            .w3-sidebar{height:100%;width:200px;background-color:#fff;position:fixed!important;z-index:1;overflow:auto}
            .w3-bar-block .w3-dropdown-hover,.w3-bar-block .w3-dropdown-click{width:100%}
            .w3-bar-block .w3-dropdown-hover .w3-dropdown-content,.w3-bar-block .w3-dropdown-click .w3-dropdown-content{min-width:100%}
            .w3-bar-block .w3-dropdown-hover .w3-button,.w3-bar-block .w3-dropdown-click .w3-button{width:100%;text-align:left;padding:8px 16px}
            .w3-main,#main{transition:margin-left .4s}
            .w3-modal{z-index:3;display:none;padding-top:100px;position:fixed;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgb(0,0,0);background-color:rgba(0,0,0,0.4)}
            .w3-modal-content{margin:auto;background-color:#fff;position:relative;padding:0;outline:0;width:600px}
            .w3-bar{width:100%;overflow:hidden}.w3-center .w3-bar{display:inline-block;width:auto}
            .w3-bar .w3-bar-item{padding:8px 16px;float:left;width:auto;border:none;display:block;outline:0}
            .w3-bar .w3-dropdown-hover,.w3-bar .w3-dropdown-click{position:static;float:left}
            .w3-bar .w3-button{white-space:normal}
            .w3-bar-block .w3-bar-item{width:100%;display:block;padding:8px 16px;text-align:left;border:none;white-space:normal;float:none;outline:0}
            .w3-bar-block.w3-center .w3-bar-item{text-align:center}.w3-block{display:block;width:100%}
            .w3-responsive{display:block;overflow-x:auto}
            .w3-container:after,.w3-container:before,.w3-panel:after,.w3-panel:before,.w3-row:after,.w3-row:before,.w3-row-padding:after,.w3-row-padding:before,
            .w3-cell-row:before,.w3-cell-row:after,.w3-clear:after,.w3-clear:before,.w3-bar:before,.w3-bar:after{content:"";display:table;clear:both}
            .w3-col,.w3-half,.w3-third,.w3-twothird,.w3-threequarter,.w3-quarter{float:left;width:100%}
            .w3-col.s1{width:8.33333%}.w3-col.s2{width:16.66666%}.w3-col.s3{width:24.99999%}.w3-col.s4{width:33.33333%}
            .w3-col.s5{width:41.66666%}.w3-col.s6{width:49.99999%}.w3-col.s7{width:58.33333%}.w3-col.s8{width:66.66666%}
            .w3-col.s9{width:74.99999%}.w3-col.s10{width:83.33333%}.w3-col.s11{width:91.66666%}.w3-col.s12{width:99.99999%}
            @media (min-width:601px){.w3-col.m1{width:8.33333%}.w3-col.m2{width:16.66666%}.w3-col.m3,.w3-quarter{width:24.99999%}.w3-col.m4,.w3-third{width:33.33333%}
            .w3-col.m5{width:41.66666%}.w3-col.m6,.w3-half{width:49.99999%}.w3-col.m7{width:58.33333%}.w3-col.m8,.w3-twothird{width:66.66666%}
            .w3-col.m9,.w3-threequarter{width:74.99999%}.w3-col.m10{width:83.33333%}.w3-col.m11{width:91.66666%}.w3-col.m12{width:99.99999%}}
            @media (min-width:993px){.w3-col.l1{width:8.33333%}.w3-col.l2{width:16.66666%}.w3-col.l3{width:24.99999%}.w3-col.l4{width:33.33333%}
            .w3-col.l5{width:41.66666%}.w3-col.l6{width:49.99999%}.w3-col.l7{width:58.33333%}.w3-col.l8{width:66.66666%}
            .w3-col.l9{width:74.99999%}.w3-col.l10{width:83.33333%}.w3-col.l11{width:91.66666%}.w3-col.l12{width:99.99999%}}
            .w3-rest{overflow:hidden}.w3-stretch{margin-left:-16px;margin-right:-16px}
            .w3-content,.w3-auto{margin-left:auto;margin-right:auto}.w3-content{max-width:980px}.w3-auto{max-width:1140px}
            .w3-cell-row{display:table;width:100%}.w3-cell{display:table-cell}
            .w3-cell-top{vertical-align:top}.w3-cell-middle{vertical-align:middle}.w3-cell-bottom{vertical-align:bottom}
            .w3-hide{display:none!important}.w3-show-block,.w3-show{display:block!important}.w3-show-inline-block{display:inline-block!important}
            @media (max-width:1205px){.w3-auto{max-width:95%}}
            @media (max-width:600px){.w3-modal-content{margin:0 10px;width:auto!important}.w3-modal{padding-top:30px}
            .w3-dropdown-hover.w3-mobile .w3-dropdown-content,.w3-dropdown-click.w3-mobile .w3-dropdown-content{position:relative}	
            .w3-hide-small{display:none!important}.w3-mobile{display:block;width:100%!important}.w3-bar-item.w3-mobile,.w3-dropdown-hover.w3-mobile,.w3-dropdown-click.w3-mobile{text-align:center}
            .w3-dropdown-hover.w3-mobile,.w3-dropdown-hover.w3-mobile .w3-btn,.w3-dropdown-hover.w3-mobile .w3-button,.w3-dropdown-click.w3-mobile,.w3-dropdown-click.w3-mobile .w3-btn,.w3-dropdown-click.w3-mobile .w3-button{width:100%}}
            @media (max-width:768px){.w3-modal-content{width:500px}.w3-modal{padding-top:50px}}
            @media (min-width:993px){.w3-modal-content{width:900px}.w3-hide-large{display:none!important}.w3-sidebar.w3-collapse{display:block!important}}
            @media (max-width:992px) and (min-width:601px){.w3-hide-medium{display:none!important}}
            @media (max-width:992px){.w3-sidebar.w3-collapse{display:none}.w3-main{margin-left:0!important;margin-right:0!important}.w3-auto{max-width:100%}}
            .w3-top,.w3-bottom{position:fixed;width:100%;z-index:1}.w3-top{top:0}.w3-bottom{bottom:0}
            .w3-overlay{position:fixed;display:none;width:100%;height:100%;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,0.5);z-index:2}
            .w3-display-topleft{position:absolute;left:0;top:0}.w3-display-topright{position:absolute;right:0;top:0}
            .w3-display-bottomleft{position:absolute;left:0;bottom:0}.w3-display-bottomright{position:absolute;right:0;bottom:0}
            .w3-display-middle{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%)}
            .w3-display-left{position:absolute;top:50%;left:0%;transform:translate(0%,-50%);-ms-transform:translate(-0%,-50%)}
            .w3-display-right{position:absolute;top:50%;right:0%;transform:translate(0%,-50%);-ms-transform:translate(0%,-50%)}
            .w3-display-topmiddle{position:absolute;left:50%;top:0;transform:translate(-50%,0%);-ms-transform:translate(-50%,0%)}
            .w3-display-bottommiddle{position:absolute;left:50%;bottom:0;transform:translate(-50%,0%);-ms-transform:translate(-50%,0%)}
            .w3-display-container:hover .w3-display-hover{display:block}.w3-display-container:hover span.w3-display-hover{display:inline-block}.w3-display-hover{display:none}
            .w3-display-position{position:absolute}
            .w3-circle{border-radius:50%}
            .w3-round-small{border-radius:2px}.w3-round,.w3-round-medium{border-radius:4px}.w3-round-large{border-radius:8px}.w3-round-xlarge{border-radius:16px}.w3-round-xxlarge{border-radius:32px}
            .w3-row-padding,.w3-row-padding>.w3-half,.w3-row-padding>.w3-third,.w3-row-padding>.w3-twothird,.w3-row-padding>.w3-threequarter,.w3-row-padding>.w3-quarter,.w3-row-padding>.w3-col{padding:0 8px}
            .w3-container,.w3-panel{padding:0.01em 16px}.w3-panel{margin-top:16px;margin-bottom:16px}
            .w3-code,.w3-codespan{font-family:Consolas,"courier new";font-size:16px}
            .w3-code{width:auto;background-color:#fff;padding:8px 12px;border-left:4px solid #4CAF50;word-wrap:break-word}
            .w3-codespan{color:crimson;background-color:#f1f1f1;padding-left:4px;padding-right:4px;font-size:110%}
            .w3-card,.w3-card-2{box-shadow:0 2px 5px 0 rgba(0,0,0,0.16),0 2px 10px 0 rgba(0,0,0,0.12)}
            .w3-card-4,.w3-hover-shadow:hover{box-shadow:0 4px 10px 0 rgba(0,0,0,0.2),0 4px 20px 0 rgba(0,0,0,0.19)}
            .w3-spin{animation:w3-spin 2s infinite linear}@keyframes w3-spin{0%{transform:rotate(0deg)}100%{transform:rotate(359deg)}}
            .w3-animate-fading{animation:fading 10s infinite}@keyframes fading{0%{opacity:0}50%{opacity:1}100%{opacity:0}}
            .w3-animate-opacity{animation:opac 0.8s}@keyframes opac{from{opacity:0} to{opacity:1}}
            .w3-animate-top{position:relative;animation:animatetop 0.4s}@keyframes animatetop{from{top:-300px;opacity:0} to{top:0;opacity:1}}
            .w3-animate-left{position:relative;animation:animateleft 0.4s}@keyframes animateleft{from{left:-300px;opacity:0} to{left:0;opacity:1}}
            .w3-animate-right{position:relative;animation:animateright 0.4s}@keyframes animateright{from{right:-300px;opacity:0} to{right:0;opacity:1}}
            .w3-animate-bottom{position:relative;animation:animatebottom 0.4s}@keyframes animatebottom{from{bottom:-300px;opacity:0} to{bottom:0;opacity:1}}
            .w3-animate-zoom {animation:animatezoom 0.6s}@keyframes animatezoom{from{transform:scale(0)} to{transform:scale(1)}}
            .w3-animate-input{transition:width 0.4s ease-in-out}.w3-animate-input:focus{width:100%!important}
            .w3-opacity,.w3-hover-opacity:hover{opacity:0.60}.w3-opacity-off,.w3-hover-opacity-off:hover{opacity:1}
            .w3-opacity-max{opacity:0.25}.w3-opacity-min{opacity:0.75}
            .w3-greyscale-max,.w3-grayscale-max,.w3-hover-greyscale:hover,.w3-hover-grayscale:hover{filter:grayscale(100%)}
            .w3-greyscale,.w3-grayscale{filter:grayscale(75%)}.w3-greyscale-min,.w3-grayscale-min{filter:grayscale(50%)}
            .w3-sepia{filter:sepia(75%)}.w3-sepia-max,.w3-hover-sepia:hover{filter:sepia(100%)}.w3-sepia-min{filter:sepia(50%)}
            .w3-tiny{font-size:10px!important}.w3-small{font-size:12px!important}.w3-medium{font-size:15px!important}.w3-large{font-size:18px!important}
            .w3-xlarge{font-size:24px!important}.w3-xxlarge{font-size:36px!important}.w3-xxxlarge{font-size:48px!important}.w3-jumbo{font-size:64px!important}
            .w3-left-align{text-align:left!important}.w3-right-align{text-align:right!important}.w3-justify{text-align:justify!important}.w3-center{text-align:center!important}
            .w3-border-0{border:0!important}.w3-border{border:1px solid #ccc!important}
            .w3-border-top{border-top:1px solid #ccc!important}.w3-border-bottom{border-bottom:1px solid #ccc!important}
            .w3-border-left{border-left:1px solid #ccc!important}.w3-border-right{border-right:1px solid #ccc!important}
            .w3-topbar{border-top:6px solid #ccc!important}.w3-bottombar{border-bottom:6px solid #ccc!important}
            .w3-leftbar{border-left:6px solid #ccc!important}.w3-rightbar{border-right:6px solid #ccc!important}
            .w3-section,.w3-code{margin-top:16px!important;margin-bottom:16px!important}
            .w3-margin{margin:16px!important}.w3-margin-top{margin-top:16px!important}.w3-margin-bottom{margin-bottom:16px!important}
            .w3-margin-left{margin-left:16px!important}.w3-margin-right{margin-right:16px!important}
            .w3-padding-small{padding:4px 8px!important}.w3-padding{padding:8px 16px!important}.w3-padding-large{padding:12px 24px!important}
            .w3-padding-16{padding-top:16px!important;padding-bottom:16px!important}.w3-padding-24{padding-top:24px!important;padding-bottom:24px!important}
            .w3-padding-32{padding-top:32px!important;padding-bottom:32px!important}.w3-padding-48{padding-top:48px!important;padding-bottom:48px!important}
            .w3-padding-64{padding-top:64px!important;padding-bottom:64px!important}
            .w3-padding-top-64{padding-top:64px!important}.w3-padding-top-48{padding-top:48px!important}
            .w3-padding-top-32{padding-top:32px!important}.w3-padding-top-24{padding-top:24px!important}
            .w3-left{float:left!important}.w3-right{float:right!important}
            .w3-button:hover{color:#000!important;background-color:#ccc!important}
            .w3-transparent,.w3-hover-none:hover{background-color:transparent!important}
            .w3-hover-none:hover{box-shadow:none!important}
            /* Colors */
            .w3-amber,.w3-hover-amber:hover{color:#000!important;background-color:#ffc107!important}
            .w3-aqua,.w3-hover-aqua:hover{color:#000!important;background-color:#00ffff!important}
            .w3-blue,.w3-hover-blue:hover{color:#fff!important;background-color:#2196F3!important}
            .w3-light-blue,.w3-hover-light-blue:hover{color:#000!important;background-color:#87CEEB!important}
            .w3-brown,.w3-hover-brown:hover{color:#fff!important;background-color:#795548!important}
            .w3-cyan,.w3-hover-cyan:hover{color:#000!important;background-color:#00bcd4!important}
            .w3-blue-grey,.w3-hover-blue-grey:hover,.w3-blue-gray,.w3-hover-blue-gray:hover{color:#fff!important;background-color:#607d8b!important}
            .w3-green,.w3-hover-green:hover{color:#fff!important;background-color:#4CAF50!important}
            .w3-light-green,.w3-hover-light-green:hover{color:#000!important;background-color:#8bc34a!important}
            .w3-indigo,.w3-hover-indigo:hover{color:#fff!important;background-color:#3f51b5!important}
            .w3-khaki,.w3-hover-khaki:hover{color:#000!important;background-color:#f0e68c!important}
            .w3-lime,.w3-hover-lime:hover{color:#000!important;background-color:#cddc39!important}
            .w3-orange,.w3-hover-orange:hover{color:#000!important;background-color:#ff9800!important}
            .w3-deep-orange,.w3-hover-deep-orange:hover{color:#fff!important;background-color:#ff5722!important}
            .w3-pink,.w3-hover-pink:hover{color:#fff!important;background-color:#e91e63!important}
            .w3-purple,.w3-hover-purple:hover{color:#fff!important;background-color:#9c27b0!important}
            .w3-deep-purple,.w3-hover-deep-purple:hover{color:#fff!important;background-color:#673ab7!important}
            .w3-red,.w3-hover-red:hover{color:#fff!important;background-color:#f44336!important}
            .w3-sand,.w3-hover-sand:hover{color:#000!important;background-color:#fdf5e6!important}
            .w3-teal,.w3-hover-teal:hover{color:#fff!important;background-color:#009688!important}
            .w3-yellow,.w3-hover-yellow:hover{color:#000!important;background-color:#ffeb3b!important}
            .w3-white,.w3-hover-white:hover{color:#000!important;background-color:#fff!important}
            .w3-black,.w3-hover-black:hover{color:#fff!important;background-color:#000!important}
            .w3-grey,.w3-hover-grey:hover,.w3-gray,.w3-hover-gray:hover{color:#000!important;background-color:#9e9e9e!important}
            .w3-light-grey,.w3-hover-light-grey:hover,.w3-light-gray,.w3-hover-light-gray:hover{color:#000!important;background-color:#f1f1f1!important}
            .w3-dark-grey,.w3-hover-dark-grey:hover,.w3-dark-gray,.w3-hover-dark-gray:hover{color:#fff!important;background-color:#616161!important}
            .w3-pale-red,.w3-hover-pale-red:hover{color:#000!important;background-color:#ffdddd!important}
            .w3-pale-green,.w3-hover-pale-green:hover{color:#000!important;background-color:#ddffdd!important}
            .w3-pale-yellow,.w3-hover-pale-yellow:hover{color:#000!important;background-color:#ffffcc!important}
            .w3-pale-blue,.w3-hover-pale-blue:hover{color:#000!important;background-color:#ddffff!important}
            .w3-text-amber,.w3-hover-text-amber:hover{color:#ffc107!important}
            .w3-text-aqua,.w3-hover-text-aqua:hover{color:#00ffff!important}
            .w3-text-blue,.w3-hover-text-blue:hover{color:#2196F3!important}
            .w3-text-light-blue,.w3-hover-text-light-blue:hover{color:#87CEEB!important}
            .w3-text-brown,.w3-hover-text-brown:hover{color:#795548!important}
            .w3-text-cyan,.w3-hover-text-cyan:hover{color:#00bcd4!important}
            .w3-text-blue-grey,.w3-hover-text-blue-grey:hover,.w3-text-blue-gray,.w3-hover-text-blue-gray:hover{color:#607d8b!important}
            .w3-text-green,.w3-hover-text-green:hover{color:#4CAF50!important}
            .w3-text-light-green,.w3-hover-text-light-green:hover{color:#8bc34a!important}
            .w3-text-indigo,.w3-hover-text-indigo:hover{color:#3f51b5!important}
            .w3-text-khaki,.w3-hover-text-khaki:hover{color:#b4aa50!important}
            .w3-text-lime,.w3-hover-text-lime:hover{color:#cddc39!important}
            .w3-text-orange,.w3-hover-text-orange:hover{color:#ff9800!important}
            .w3-text-deep-orange,.w3-hover-text-deep-orange:hover{color:#ff5722!important}
            .w3-text-pink,.w3-hover-text-pink:hover{color:#e91e63!important}
            .w3-text-purple,.w3-hover-text-purple:hover{color:#9c27b0!important}
            .w3-text-deep-purple,.w3-hover-text-deep-purple:hover{color:#673ab7!important}
            .w3-text-red,.w3-hover-text-red:hover{color:#f44336!important}
            .w3-text-sand,.w3-hover-text-sand:hover{color:#fdf5e6!important}
            .w3-text-teal,.w3-hover-text-teal:hover{color:#009688!important}
            .w3-text-yellow,.w3-hover-text-yellow:hover{color:#d2be0e!important}
            .w3-text-white,.w3-hover-text-white:hover{color:#fff!important}
            .w3-text-black,.w3-hover-text-black:hover{color:#000!important}
            .w3-text-grey,.w3-hover-text-grey:hover,.w3-text-gray,.w3-hover-text-gray:hover{color:#757575!important}
            .w3-text-light-grey,.w3-hover-text-light-grey:hover,.w3-text-light-gray,.w3-hover-text-light-gray:hover{color:#f1f1f1!important}
            .w3-text-dark-grey,.w3-hover-text-dark-grey:hover,.w3-text-dark-gray,.w3-hover-text-dark-gray:hover{color:#3a3a3a!important}
            .w3-border-amber,.w3-hover-border-amber:hover{border-color:#ffc107!important}
            .w3-border-aqua,.w3-hover-border-aqua:hover{border-color:#00ffff!important}
            .w3-border-blue,.w3-hover-border-blue:hover{border-color:#2196F3!important}
            .w3-border-light-blue,.w3-hover-border-light-blue:hover{border-color:#87CEEB!important}
            .w3-border-brown,.w3-hover-border-brown:hover{border-color:#795548!important}
            .w3-border-cyan,.w3-hover-border-cyan:hover{border-color:#00bcd4!important}
            .w3-border-blue-grey,.w3-hover-border-blue-grey:hover,.w3-border-blue-gray,.w3-hover-border-blue-gray:hover{border-color:#607d8b!important}
            .w3-border-green,.w3-hover-border-green:hover{border-color:#4CAF50!important}
            .w3-border-light-green,.w3-hover-border-light-green:hover{border-color:#8bc34a!important}
            .w3-border-indigo,.w3-hover-border-indigo:hover{border-color:#3f51b5!important}
            .w3-border-khaki,.w3-hover-border-khaki:hover{border-color:#f0e68c!important}
            .w3-border-lime,.w3-hover-border-lime:hover{border-color:#cddc39!important}
            .w3-border-orange,.w3-hover-border-orange:hover{border-color:#ff9800!important}
            .w3-border-deep-orange,.w3-hover-border-deep-orange:hover{border-color:#ff5722!important}
            .w3-border-pink,.w3-hover-border-pink:hover{border-color:#e91e63!important}
            .w3-border-purple,.w3-hover-border-purple:hover{border-color:#9c27b0!important}
            .w3-border-deep-purple,.w3-hover-border-deep-purple:hover{border-color:#673ab7!important}
            .w3-border-red,.w3-hover-border-red:hover{border-color:#f44336!important}
            .w3-border-sand,.w3-hover-border-sand:hover{border-color:#fdf5e6!important}
            .w3-border-teal,.w3-hover-border-teal:hover{border-color:#009688!important}
            .w3-border-yellow,.w3-hover-border-yellow:hover{border-color:#ffeb3b!important}
            .w3-border-white,.w3-hover-border-white:hover{border-color:#fff!important}
            .w3-border-black,.w3-hover-border-black:hover{border-color:#000!important}
            .w3-border-grey,.w3-hover-border-grey:hover,.w3-border-gray,.w3-hover-border-gray:hover{border-color:#9e9e9e!important}
            .w3-border-light-grey,.w3-hover-border-light-grey:hover,.w3-border-light-gray,.w3-hover-border-light-gray:hover{border-color:#f1f1f1!important}
            .w3-border-dark-grey,.w3-hover-border-dark-grey:hover,.w3-border-dark-gray,.w3-hover-border-dark-gray:hover{border-color:#616161!important}
            .w3-border-pale-red,.w3-hover-border-pale-red:hover{border-color:#ffe7e7!important}.w3-border-pale-green,.w3-hover-border-pale-green:hover{border-color:#e7ffe7!important}
            .w3-border-pale-yellow,.w3-hover-border-pale-yellow:hover{border-color:#ffffcc!important}.w3-border-pale-blue,.w3-hover-border-pale-blue:hover{border-color:#e7ffff!important}

            body {
                max-width: 720px;
                border: 1px solid black;
            }

            * {
                box-sizing: border-box;
            }
            #MT_pulseList {
                width: 100%;
                font-family: monospace;
                font-size: min(3vw,15px);
            }
        </style>
        <script type="text/javascript">
            /** An example implementation of a TMS motor threshold (MT) estimator class
             *
             * This class implements DCS1-H, DCS1-HA, ACS1-H and ACS1-HA from the manuscript.
             * In addition, the class implements a coarse estimate of the probable range of the MT estimation.
             * 
             * Author: Lari Koponen (initial version: DCS1-H), Boshuo Wang (additional versions and parameter choices, other UI updates and improvements)
             * Version: 2023-01-18
             */
            var MT_estimator;

            class SA_MT_estimator {								// Stochastic approximation (SA). AKA stochastic root-finding
                constructor(MT_0, Vpp_th, digital, adaptive, a_0) {
                    if (MT_0=="") {								// Initial amplitude. Check for a missing value
                        throw 'Please specify an initial amplitude, a number between 0 and 100.'
                    }
                    MT_0=Number(MT_0);							// Convert to a 'Number' and check for a value in the desired range
                    
					if (!(MT_0>0 && MT_0<=100)) { 				// Important to check for the inverse of range to capture a NaN
                        throw 'Initial amplitude is not a positive number ≤100.';
                    }
					if (!digital) {								// Only check definition of threshold EMG Vpp for analog methods
						if (Vpp_th=="") {						// Check for a missing value
							throw 'Please specify an EMG threshold.';
						}
						Vpp_th=Number(Vpp_th);					// Convert to a 'Number' and check for a value in the desired range
						if (!(Vpp_th>0 && Vpp_th<=1000)){ 		// Important to check for the inverse of range to capture a NaN
							throw 'EMG threshold is not a positive value within 1 mV.';
						}
					}
					
					if (a_0=="") {								// Initial amplitude. Check for a missing value
                        throw 'Please specify an initial step, a number between 1 and 20.'
                    }
                    a_0=Number(a_0);							// Convert to a 'Number' and check for a value in the desired range
                    if (!(a_0>=1 && a_0<=20)) { 				// Important to check for the inverse of range to capture a NaN
                        throw 'Initial amplitude is not a number between 1 and 20.';
                    }
					
					// Initialize the class
                    this.Vpp_th=Vpp_th;						// μV
					this.digital=digital;					// boolean
					this.adaptive=adaptive;					// boolean
					this.a_0=a_0;							// % MSO
					
                    this.pulses=[];              			// List of amplitude of TMS pulses, % MSO
                    this.Vpps=[];                			// List of Vpp EMG responses, one for each pulse. Only relevant for analog method, μV
                    this.MEPs=[];               			// List of binary responses, one for each pulse, boolean
					this.countMEPs=[];						// Count of suprathreshold responses over the past 10 pulses
                    this.isCI=[];							// Boolean. True: estimation range is 95% CI. False: estimation range is not CI.
                    this.sign_changes=0;					// Number of sign changes for adaptive stepping. Not used for non-adaptive methods
					this.steps=[];							// List of steps, a_i/i*deltaY
					this.deltaYs=[];						// List of deltaY. Digital version: 1 & -1. Analog version: log10(Vpp/Vpp_th).
					this.MT_nextPulse=Math.round(MT_0);		// Stimulator output for the next TMS pulse to be delivered.
					this.MT_estimate=MT_0;       			// Current estimate of the MT.
                    this.MT_estimate_CI=[0,100]; 			// Current "confidence interval" for the MT: range of probable values at step 20 or 10 steps after current step
				}

                // Number of TMS pulses
                get index() {
                    return this.pulses.length;
                }
                
                // Description of the quality of current estimation, based on relative frequency of positive/negative responses during last 10 pulses
                get description() {
                    if (this.index<15) {
                        return "This estimate is likely inaccurate due to too few pulses ("+this.index+").";
                    } else {
                        // A good estimation sequence must have both MEPs and no MEPs towards the end, count last 10 pulses
                        var MEPs=this.countMEPs[this.index-1];
                        
						if (this.digital){
							if (MEPs<3) {
								return "The last 10 pulses have too few responses ("+MEPs+"), consider a restart or give a few pulses more.";
							} else if (MEPs>7) {
								return "The last 10 pulses have too many responses ("+MEPs+"), consider a restart or give a few pulses more.";
							} else {
								return "At "+this.index+" pulses, and with reasonable number of both responses and no responses, this estimate is potentially accurate.";
							}
						} else {
							if (MEPs<3) {
								return "The last 10 pulses have too few suprathreshold responses ("+MEPs+"), consider a restart or give a few pulses more.";
							} else if (MEPs>7) {
								return "The last 10 pulses have too few subthreshold responses ("+(10-MEPs)+"), consider a restart or give a few pulses more.";
							} else {
								return "At "+this.index+" pulses, and with reasonable number of both supra- and subthreshold responses, this estimate is potentially accurate.";
							}
						}
                    }
                }
                
                stimulate(MEP,Vpp) {									// Update routine
                    this.pulses.push(this.MT_nextPulse);				// Increment pulse list with the current pulse
                    var index=this.index;
					var a_0=this.a_0;
					var tmp=0;
					
					if (this.digital) {
						var actualMEP=MEP;
						var deltaY=actualMEP?1:-1;						// Step for updating the MT estimate based on binary MEP response (specific to DCS)
					} else {
						this.Vpps.push(Vpp);
						var actualMEP=(Vpp>=this.Vpp_th)?true:false;	// Use Vpp to determine MEP, not dummy input for analog methods
						var deltaY=Math.log10(Vpp/this.Vpp_th);			// Step for updating the MT estimate based on Vpp response (specific to ACS)
					}
					this.deltaYs.push(deltaY);							// Only utilized for analog methods
					this.MEPs.push(actualMEP);							// Only utilized for adaptive stepping
					
					
					var new_MEPs;
					if (index==1) {
						new_MEPs=actualMEP?1:0;
						this.countMEPs.push(new_MEPs);
					} else if (index<=10) {
						new_MEPs=this.countMEPs[index-2]+(actualMEP?1:0);
						this.countMEPs.push(new_MEPs);
					} else {
						if (actualMEP != this.MEPs[index-1-10]){
							new_MEPs=actualMEP?1:-1;
						} else {
							new_MEPs=0;
						}
						this.countMEPs.push(this.countMEPs[index-2]+new_MEPs);
					}
					
					if ((this.adaptive)&&(index>1)) {					// Adaptive stepping after step 1
						if (actualMEP != this.MEPs[index-2]) {
							this.sign_changes+=1;						// Number of sign changes
						}
					}
					var actual_index=(this.adaptive)?(this.sign_changes+1):index;
					var step=-a_0/actual_index*deltaY;
					this.steps.push(step);
					this.MT_estimate+=step;
					this.MT_estimate=(this.MT_estimate>=0)?this.MT_estimate:0;		// MT estimate clamped to 0 on lower end
					
					// Update the "confidence interval", probable range of threshold (naive method)
					if (this.digital) {
						var expected_deltaY=1;
					} else {					// for analog method, calculate average step size
						var sum_deltaYs=0;
						var averaging_start=(index>=10)?(index-10):0;			// average over past 10 pulses, or back to first pulse if less than 10 pulses
						for (let i=averaging_start;i<index;i++) {
							sum_deltaYs+=Math.abs(this.deltaYs[i]);
						}
						var expected_deltaY=sum_deltaYs/(index-averaging_start);
					}
					
					var LB,UB;
					if (index<10) {
						this.isCI.push(false);	
						var additional_steps=(20-index);
						// Worst case scenario is one-sided stepping
						for (let i=actual_index+1;i<actual_index+1+additional_steps;i++) {
							tmp+=1/i;
						}
						tmp*=(a_0*expected_deltaY);			// scale by step size
						LB=tmp;
						UB=tmp;
						
					} else {
						additional_steps=10;
						LB = get_CI_range(10-this.countMEPs[index-1],index)*(a_0*expected_deltaY);
						UB = get_CI_range(this.countMEPs[index-1],   index)*(a_0*expected_deltaY);
						if ((this.countMEPs[index-1]>=3) && this.countMEPs[index-1]<=7) {
							this.isCI.push(true);
						} else {
							this.isCI.push(false);
						}
					}
					this.MT_estimate_CI=[this.MT_estimate-LB,this.MT_estimate+UB];
					
					// Update next pulse, clamped between 1 and 100
					this.MT_nextPulse=(Math.round(this.MT_estimate)>0)?Math.round(this.MT_estimate):1;
					this.MT_nextPulse=(this.MT_nextPulse<=100)?this.MT_nextPulse:100;
                }
            }
			
			function MT_UI_start() {
				document.getElementById("digital").checked=true;
				document.getElementById("adapt").checked=true;
				document.getElementById("default_a0").checked=true;
				
				document.getElementById("Vpp_th").disabled=true;
				document.getElementById("Vpp_th").value=50;
				document.getElementById("a0_custom").disabled=true;
				document.getElementById("a0_custom").value=get_default_a0().toFixed(1);
				
				document.getElementById("MT_0").value=50;
				document.getElementById("V_pp").value=50;
				
				document.getElementById("MT_reset").disabled=true;
				window.addEventListener("keydown",MT_keyboard,true);
				MT_UI();
			}
            // User interface update routine
            function MT_UI() {
                if (MT_estimator) {
					var method_str;
					if (MT_estimator.digital){
						var CS_str="DCS1-H";
						var method_str="Digital control sequence";
					} else {
						var CS_str="ACS1-H";
						var method_str="Analog control sequence";
					}
					if (MT_estimator.adaptive) {
						CS_str+="A";
						method_str+=", adaptive stepping";
					} else {
						method_str+=", non-adaptive stepping";
					}
					//var CS_str=(MT_estimator.digital)?"DCS1-H":"ACS1-H";					// control sequency string
					//var A_str=(MT_estimator.adaptive)?"A, adaptive":", non-adaptive";		// adaptiveness string
					var a_0=Number(document.getElementById("a0_custom").value);
					use_default_a0=document.getElementById("default_a0").checked;
					var a0_str=(use_default_a0)?"default <i>a</i><sub>0</sub>.  ":("custom <i>a</i><sub>0</sub>: "+a_0.toFixed(1)+"% MSO. ");
					
					// additional information for analog methods on defined EMG threshold
					var add_str="";
					if (!(MT_estimator.digital) && (MT_estimator.Vpp_th!=50)) {
						add_str="<br><strong>Non-default EMG threshold</strong>: "+MT_estimator.Vpp_th.toFixed(0)+" μV<sub>pp</sub>.";
					}
					//document.getElementById("MT_method").innerHTML="<strong>"+CS_str+A_str+" stepping.</strong> Initial step size:"+MT_estimator.a_0.toFixed(1)+"% MSO. "+add_str;
                    document.getElementById("MT_method").innerHTML="<strong>"+CS_str+"</strong>. "+method_str+" and "+a0_str+add_str;	
                    document.getElementById("MT_nextPulse").innerHTML="Give a TMS pulse at <strong>"+MT_estimator.MT_nextPulse+"% MSO</strong>.";
					
					var x=MT_estimator.MT_estimate.toFixed(1);
                    var y=MT_estimator.MT_estimate_CI[0].toFixed(1);
                    var z=MT_estimator.MT_estimate_CI[1].toFixed(1);
					var esti_str="Pulse No. "+MT_estimator.index+": <br>Current estimate of MT is <strong>"+x+"% MSO</strong>, ";
					if (MT_estimator.index<10) {
						esti_str+="with a probable range of ("+y+"%, "+z+"%) MSO.";
					} else if (MT_estimator.isCI[MT_estimator.index-1]){
						esti_str+="with a 95% confidence interval of ["+y+"%, "+z+"%] MSO.";
					} else if (MT_estimator.countMEPs[MT_estimator.index-1]>7) {
						esti_str+="which is outside of the probable range of ("+y+"%, "+z+"%] MSO.";
					} else {
						esti_str+="which is outside of the probable range of ["+y+"%, "+z+"%) MSO.";
					}
					
					
                    document.getElementById("MT_estimate").innerHTML=esti_str;
                    document.getElementById("MT_estimateDescription").innerHTML=MT_estimator.description;
                } else {
                    document.getElementById("MT_method").innerHTML="";
					document.getElementById("MT_nextPulse").innerHTML="Start procedure first.";
                    document.getElementById("MT_estimate").innerHTML="Current MT estimate is undefined.";
                    document.getElementById("MT_estimateDescription").innerHTML="";
                }
            }
			
            // Keyboard event listener, for quick data entry
            function MT_keyboard(event) {
                // Ignore already processed events
                if (event.defaultPrevented) {
                    return;
                }
				switch (event.key) {
                    case "s":
                        if (!document.getElementById("MT_start").disabled) {
							MT_start();
						}
                        break;
                    case "r":
                        if (!document.getElementById("MT_reset").disabled) {
							MT_reset();
						}
                        break;
					case "c":
						copyToClipboard()
						break;
                }
                switch (event.key) {
					case "y":
						if (MT_estimator.digital) {
							MT_stimulate(true);
						}
						break;
					case "n":
						if (MT_estimator.digital) {
							MT_stimulate(false);
						}
						break;
					case "Enter":
						if (!MT_estimator.digital) {
							MT_stimulate(false);		// Dummy for analog method
						}
						break;
					default: // Ignore other events and let them pass forward
						//return;
				}
				// Prevent processed events from propagating
                //event.preventDefault();
            }

            // Process start button
            function MT_start() {
				var MT_0=document.getElementById("MT_0").value;
				var Vpp_th=document.getElementById("Vpp_th").value;
				var digital=(document.getElementById("digital").checked)?true:false;
                var adapt=(document.getElementById('adapt').checked)?true:false;
				var a_0=document.getElementById("a0_custom").value;
				
				try {
					// Create MT estimator object
                    MT_estimator=new SA_MT_estimator(MT_0, Vpp_th, digital, adapt, a_0);

                    // Set states for buttons and inputs for choosing methods and setting parameters, disable all except reset button
                    document.getElementById("non_adapt").disabled=true;
					document.getElementById("adapt").disabled=true;
					document.getElementById("digital").disabled=true;
					document.getElementById("analog").disabled=true;
					document.getElementById("default_a0").disabled=true;
					document.getElementById("custom_a0").disabled=true;
					
					document.getElementById("Vpp_th").disabled=true;
					document.getElementById("a0_custom").disabled=true;
					document.getElementById("MT_0").disabled=true;
					
					document.getElementById("MT_start").disabled=true;
					document.getElementById("Start_msg").hidden=true;
					document.getElementById("MT_reset").disabled=false;
					document.getElementById("Reset_msg").hidden=false;
					
					// Reset pulse list, add header to it based on method
                    document.getElementById("MT_pulseList").rows=MT_estimator.index+2;
					
					// Set states for buttons and inputs related to MT procedure
					if (digital) {							// Enable and display buttons related to digital method
						document.getElementById("is_suprathreshold_bottoms").hidden=false;
						document.getElementById("MT_MEP").disabled=false;
						document.getElementById("MT_noMEP").disabled=false;
						document.getElementById("MT_pulseList").innerHTML="No.\tAmplitude\tResponse\tStep\tNext\tMT\tMT range/CI\n";
					} else {								// Enable and display buttons related to analog method
						document.getElementById("response_Vpp_box").hidden=false;
						document.getElementById("V_pp").disabled=false;
						document.getElementById("Enter_Vpp").disabled=false;
						document.getElementById("MT_pulseList").innerHTML="No.\tAmplitude\tEMG\tResponse\tStep\tNext\tMT\tMT range/CI\n";
					}
					
                    // Add event listener for keyboard
                    //window.addEventListener("keydown",MT_keyboard,true);
                } catch (e) {
                    alert(e);
                }
                // Update user interface
                MT_UI();
            }

            // Process reset button
            function MT_reset() {
                var digital=(document.getElementById("digital").checked)?true:false;
                var default_a0=(document.getElementById('default_a0').checked)?true:false;
				
				// Remove MT estimator object
                MT_estimator=null;
				
                // Reset button states
                document.getElementById("non_adapt").disabled=false;
				document.getElementById("adapt").disabled=false;
				document.getElementById("digital").disabled=false;
				document.getElementById("analog").disabled=false;
				document.getElementById("default_a0").disabled=false;
				document.getElementById("custom_a0").disabled=false;
					
				if (!digital) {		//Enable threshold definition only when analog is selected
					document.getElementById("Vpp_th").disabled=false;
					//document.getElementById("input_Vpp_th_box").hidden=false;
				} else {
					//document.getElementById("input_Vpp_th_box").hidden=true;
				}
				if (!default_a0) {
					document.getElementById("a0_custom").disabled=false;
				}
				document.getElementById("MT_0").disabled=false;
					
				
				document.getElementById("MT_start").disabled=false;
				document.getElementById("Start_msg").hidden=false;
                document.getElementById("MT_reset").disabled=true;
				document.getElementById("Reset_msg").hidden=true;
                	
				document.getElementById("is_suprathreshold_bottoms").hidden=true;
				document.getElementById("MT_MEP").disabled=true;
                document.getElementById("MT_noMEP").disabled=true;
				
                document.getElementById("response_Vpp_box").hidden=true;
				document.getElementById("Enter_Vpp").disabled=true;
                document.getElementById("V_pp").disabled=true;
				
                // Remove event listener from keyboard
                //window.removeEventListener("keydown",MT_keyboard,true);
				
                // Update user inferface
                MT_UI();
            }

            // Process stimulate button
            function MT_stimulate(MEP) {
                if (!MT_estimator.digital) {			// Get EMG response for analog methods
					try {
						var Vpp=document.getElementById("V_pp").value;
						if (Vpp=="") {					// Check for a missing value
							throw 'Please specify EMG response.';
						}
						Vpp=Number(Vpp);				// Convert to a 'Number' and check for a value in the desired range
						if (!(Vpp>0 && Vpp<=1000000)){ 	// Important to check for the inverse of range to capture a NaN
							throw 'EMG response is not a positive value within 1 V.';
						}
					} catch (e) {
						alert(e);
						return
					}
				} else {
					var Vpp=50;							// Dummy value for digital methods
				}
				// Update MT estimator
                MT_estimator.stimulate(MEP,Vpp);
                
                // Update pulse list
				var u=MT_estimator.pulses[MT_estimator.index-1];
                if (Math.abs(MT_estimator.steps[MT_estimator.index-1])>=1){
					var v=MT_estimator.steps[MT_estimator.index-1].toFixed(1);
				} else {
					var v=MT_estimator.steps[MT_estimator.index-1].toFixed(2);
				}
				var w=MT_estimator.MT_nextPulse;
				var x=MT_estimator.MT_estimate.toFixed(1);
                var y=MT_estimator.MT_estimate_CI[0].toFixed(1);
                var z=MT_estimator.MT_estimate_CI[1].toFixed(1);
				
                var str=MT_estimator.index+"\t"+u+"\t\t";
				if (MT_estimator.digital){
					var actualMEP=(MEP)?"Yes":"No";
					str+=actualMEP+"\t";
                } else {
					var actualMEP=(Vpp>=MT_estimator.Vpp_th)?"Suprathreshold":"Subthreshold";
					str+=Vpp.toFixed(0)+"\t"+actualMEP;
				}
				str+="\t"+v+"\t"+w+"\t"+x+"\t";
				if (MT_estimator.index<10) {
					str+="("+y+", "+z+")"+"\n";
				} else if (MT_estimator.isCI[MT_estimator.index-1]){
					str+="["+y+", "+z+"]"+"\n";
				} else if (MT_estimator.countMEPs[MT_estimator.index-1]>7) {
					str+="("+y+", "+z+"]"+"\n";
				} else {
					str+="["+y+", "+z+")"+"\n";
				}
				
                document.getElementById("MT_pulseList").innerHTML+=str;
                document.getElementById("MT_pulseList").rows=MT_estimator.index+2;

                // Update user inferface
                MT_UI();
            }

            function copyToClipboard() {
                var element=document.getElementById("MT_pulseList");

                element.select();
                element.setSelectionRange(0,9999);

                navigator.clipboard.writeText(element.textContent).then(() => {alert("Copied pulse list to clipboard.")}).catch(() => {alert("Copy to clipboard failed, a known problem with Android phones.")});
            }
		
			function handleClick_CS(radio) {
				if (radio.value=="DCS1") {
					//document.getElementById("input_Vpp_th_box").hidden=true;
					document.getElementById("Vpp_th").disabled=true;
					document.getElementById("Vpp_th").value=50;
					document.getElementById("V_pp").value=50;
				} else {
					//document.getElementById("input_Vpp_th_box").hidden=false;
					document.getElementById("Vpp_th").disabled=false;
				}
				if (document.getElementById("default_a0").checked){
					document.getElementById("a0_custom").value=get_default_a0().toFixed(1);
				}
			}
			function handleClick_A(radio) {
				if (document.getElementById("default_a0").checked){
					document.getElementById("a0_custom").value=get_default_a0().toFixed(1);
				}
			}
			function handleClick_a0(radio) {
				if (radio.value=="default") {
					//document.getElementById("input_a0_box").hidden=true;
					document.getElementById("a0_custom").disabled=true;
					document.getElementById("a0_custom").value=get_default_a0().toFixed(1);
				} else {
					//document.getElementById("input_a0_box").hidden=false;
					document.getElementById("a0_custom").disabled=false;
				}
				if (document.getElementById('default_a0').checked){
					
				}
			}
			function get_default_a0() {
				var a_0=6.67;	
				if (document.getElementById('digital').checked){
					if (document.getElementById('adapt').checked){
						a_0*=0.63;			// Optimal, slightly adjusted from paper
					} else {
						// default is optimal
					}
				} else {
					if (document.getElementById('adapt').checked){
						// default is optimal
					} else {
						a_0*=1.58;				// Optimal, slightly adjusted from paper
					}
				}
				return a_0;
			}
			
			function get_CI_range(MEPs,index) {
				var LUT;
				if (MEPs<=2) {
					LUT = [0.6688,0.6255,0.5876,0.5542,0.5244,0.4977,0.4737,0.4519,0.4321,0.4139,0.3972,0.3819,0.3677,0.3545,0.3423,0.3308,0.3201,0.3101,0.3007,0.2919,0.2836,0.2757,0.2682,0.2612,0.2545,0.2482,0.2421,0.2364,0.2309,0.2257,0.2207,0.2159,0.2113,0.2069,0.2027,0.1987,0.1948,0.191,0.1875,0.184,0.1807,0.1775,0.1743,0.1714,0.1685,0.1657,0.163,0.1603,0.1578,0.1553,0.153,0.1507,0.1484,0.1462,0.1441,0.1421,0.1401,0.1381,0.1363,0.1344,0.1326,0.1309,0.1292,0.1276,0.126,0.1244,0.1229,0.1214,0.1199,0.1185,0.1171,0.1157,0.1144,0.1131,0.1118,0.1106,0.1094,0.1082,0.1071,0.1059,0.1048,0.1037,0.1027,0.1016,0.1006,0.09958,0.0986,0.09764,0.09669,0.09577,0.09486];
						// index: 10-100 -> 0-90
				} else if (MEPs==3){
					LUT = [0.5635,0.5255,0.4924,0.4632,0.4374,0.4144,0.3937,0.375,0.358,0.3425,0.3283,0.3152,0.3032,0.292,0.2816,0.272,0.263,0.2546,0.2467,0.2393,0.2323,0.2257,0.2195,0.2136,0.208,0.2027,0.1977,0.1929,0.1883,0.184,0.1798,0.1759,0.1721,0.1685,0.165,0.1616,0.1584,0.1553,0.1524,0.1495,0.1468,0.1441,0.1416,0.1391,0.1367,0.1344,0.1322,0.13,0.128,0.1259,0.124,0.1221,0.1202,0.1185,0.1167,0.1151,0.1134,0.1118,0.1103,0.1088,0.1073,0.1059,0.1045,0.1032,0.1019,0.1006,0.09932,0.0981,0.09691,0.09575,0.09462,0.09351,0.09243,0.09137,0.09034,0.08933,0.08834,0.08738,0.08643,0.08551,0.0846,0.08372,0.08285,0.082,0.08117,0.08035,0.07955,0.07877,0.078,0.07725,0.07651];
				} else if (MEPs==4){
					LUT = [0.4577,0.425,0.3967,0.372,0.3502,0.3308,0.3134,0.2978,0.2837,0.2709,0.2592,0.2484,0.2385,0.2294,0.2209,0.2131,0.2058,0.1989,0.1925,0.1866,0.1809,0.1756,0.1706,0.1659,0.1614,0.1572,0.1532,0.1494,0.1458,0.1423,0.139,0.1358,0.1328,0.13,0.1272,0.1246,0.122,0.1196,0.1173,0.115,0.1128,0.1108,0.1088,0.1068,0.105,0.1031,0.1014,0.09972,0.09809,0.09651,0.09498,0.0935,0.09207,0.09068,0.08933,0.08802,0.08674,0.08551,0.08431,0.08314,0.082,0.0809,0.07982,0.07877,0.07775,0.07676,0.07579,0.07484,0.07392,0.07302,0.07214,0.07128,0.07045,0.06963,0.06883,0.06805,0.06729,0.06654,0.06581,0.0651,0.0644,0.06371,0.06305,0.06239,0.06175,0.06112,0.0605,0.0599,0.05931,0.05873,0.05816];
				} else if (MEPs==5){
					LUT = [0.3536,0.3338,0.3161,0.3002,0.2858,0.2727,0.2608,0.2499,0.2398,0.2306,0.222,0.2141,0.2067,0.1997,0.1933,0.1872,0.1815,0.1762,0.1712,0.1664,0.1619,0.1576,0.1536,0.1497,0.1461,0.1426,0.1393,0.1361,0.1331,0.1302,0.1274,0.1248,0.1222,0.1198,0.1174,0.1152,0.113,0.1109,0.1089,0.107,0.1051,0.1033,0.1015,0.09983,0.0982,0.09662,0.09508,0.0936,0.09216,0.09076,0.08941,0.0881,0.08682,0.08558,0.08438,0.08321,0.08207,0.08096,0.07988,0.07883,0.07781,0.07681,0.07584,0.07489,0.07397,0.07307,0.07219,0.07133,0.07049,0.06967,0.06887,0.06809,0.06732,0.06658,0.06585,0.06513,0.06443,0.06375,0.06308,0.06242,0.06178,0.06115,0.06053,0.05992,0.05933,0.05875,0.05818,0.05762,0.05707,0.05654,0.05601];
				} else if (MEPs==6){
					LUT = [0.222,0.2078,0.1962,0.1871,0.1791,0.1717,0.1649,0.1586,0.1526,0.147,0.1418,0.1369,0.1324,0.1281,0.1242,0.1204,0.1169,0.1136,0.1104,0.1075,0.1047,0.102,0.09945,0.09704,0.09474,0.09255,0.09045,0.08845,0.08654,0.08471,0.08295,0.08126,0.07964,0.07809,0.07659,0.07515,0.07377,0.07243,0.07114,0.0699,0.0687,0.06754,0.06642,0.06533,0.06428,0.06326,0.06228,0.06132,0.0604,0.0595,0.05863,0.05778,0.05696,0.05616,0.05538,0.05462,0.05389,0.05317,0.05247,0.05179,0.05113,0.05049,0.04986,0.04924,0.04864,0.04806,0.04749,0.04693,0.04639,0.04585,0.04533,0.04483,0.04433,0.04384,0.04337,0.0429,0.04245,0.042,0.04157,0.04114,0.04072,0.04031,0.03991,0.03951,0.03913,0.03875,0.03837,0.03801,0.03765,0.0373,0.03696];
				} else if (MEPs==7){
					LUT = [0.07207,0.06448,0.05881,0.05338,0.04965,0.04463,0.04121,0.03757,0.0344,0.03161,0.02916,0.02698,0.02503,0.02329,0.02173,0.02032,0.01905,0.01789,0.01683,0.01587,0.01498,0.01417,0.01342,0.01273,0.0121,0.01151,0.01096,0.01045,0.009972,0.009529,0.009114,0.008727,0.008363,0.008022,0.007701,0.007399,0.007115,0.006847,0.006593,0.006354,0.006127,0.005912,0.005709,0.005515,0.005332,0.005157,0.004991,0.004833,0.004682,0.004538,0.004401,0.00427,0.004144,0.004024,0.00391,0.0038,0.003694,0.003593,0.003496,0.003403,0.003314,0.003228,0.003145,0.003066,0.002989,0.002916,0.002845,0.002776,0.00271,0.002646,0.002585,0.002526,0.002468,0.002413,0.00236,0.002308,0.002258,0.002209,0.002162,0.002117,0.002073,0.00203,0.001989,0.001949,0.00191,0.001872,0.001835,0.0018,0.001765,0.001732,0.001699];
				} else if (MEPs==8){
					LUT = [-0.097,-0.09267,-0.08888,-0.08575,-0.08251,-0.07942,-0.07643,-0.07354,-0.07086,-0.06839,-0.06609,-0.06405,-0.06214,-0.06032,-0.05861,-0.05698,-0.05544,-0.05398,-0.05259,-0.05127,-0.05001,-0.04881,-0.04766,-0.04657,-0.04553,-0.04453,-0.04357,-0.04265,-0.04177,-0.04092,-0.04011,-0.03933,-0.03858,-0.03785,-0.03715,-0.03648,-0.03583,-0.03521,-0.0346,-0.03402,-0.03345,-0.0329,-0.03237,-0.03186,-0.03136,-0.03088,-0.03042,-0.02996,-0.02952,-0.02909,-0.02868,-0.02827,-0.02788,-0.0275,-0.02713,-0.02677,-0.02641,-0.02607,-0.02574,-0.02541,-0.02509,-0.02478,-0.02448,-0.02419,-0.0239,-0.02362,-0.02334,-0.02307,-0.02281,-0.02255,-0.0223,-0.02206,-0.02182,-0.02158,-0.02135,-0.02113,-0.02091,-0.02069,-0.02048,-0.02027,-0.02007,-0.01987,-0.01967,-0.01948,-0.0193,-0.01911,-0.01893,-0.01875,-0.01858,-0.01841,-0.01824];
				} else {
					LUT = [-0.2845,-0.265,-0.2479,-0.2334,-0.2206,-0.2088,-0.1981,-0.1886,-0.1799,-0.172,-0.1648,-0.1582,-0.152,-0.1464,-0.1412,-0.1363,-0.1317,-0.1275,-0.1236,-0.1198,-0.1163,-0.113,-0.1099,-0.1069,-0.1041,-0.1014,-0.0989,-0.0965,-0.09421,-0.09203,-0.08995,-0.08796,-0.08605,-0.08423,-0.08249,-0.08081,-0.0792,-0.07766,-0.07617,-0.07474,-0.07337,-0.07204,-0.07076,-0.06953,-0.06833,-0.06718,-0.06607,-0.06499,-0.06395,-0.06294,-0.06196,-0.06101,-0.06009,-0.0592,-0.05834,-0.0575,-0.05668,-0.05589,-0.05511,-0.05436,-0.05363,-0.05292,-0.05223,-0.05155,-0.0509,-0.05026,-0.04963,-0.04902,-0.04843,-0.04785,-0.04728,-0.04673,-0.04619,-0.04566,-0.04514,-0.04464,-0.04414,-0.04366,-0.04319,-0.04273,-0.04228,-0.04183,-0.0414,-0.04097,-0.04056,-0.04015,-0.03975,-0.03936,-0.03898,-0.0386,-0.03823];
				}
				return (index<=100)?LUT[index-10]:LUT[90];
			}
        </script>
    </head> 
	
    <body onload="MT_UI_start()">
        <div class="w3-container w3-indigo">
            <h1>TMS Motor Threshold (MT) Estimation App</h1>
        </div>
        <div class="w3-container w3-blue">
            <h2>Stochastic Approximation MT Estimator (SAMTE)</h2>
        </div>
        <div class="w3-container">
			<table><tr><td><fieldset>
				<legend>Estimation method</legend>
					<fieldset>
						<legend>Control sequence</legend>
						<div>
							<input type="radio" id="digital" name="control_sequence" onclick="handleClick_CS(this);" value="DCS1" checked>
							<label for="DCS1">Digital (default)</label>
						</div>
						<div>	
							<input type="radio" id="analog"  name="control_sequence" onclick="handleClick_CS(this);" value="ACS1">
							<!--<div id="input_Vpp_th_box">-->
							<label for="ACS1">Analog, with EMG threshold:</label>
							<input type="number" id="Vpp_th" name="Vpp_th" max="1000" min="1" placeholder="50" step="1" value="50" size="4" disabled required>
							μV<sub>pp</sub>, (0 to 1000].
						</div>	
					</fieldset>
					<fieldset>
						<legend>Stepping adaptiveness of control sequence</legend>
						<div>
							<input type="radio" id="adapt"     name="stepping_method" onclick="handleClick_A(this);" value="adapt" checked>
							<label for="adapt">Adaptive (default)</label>
						</div>
						<div>
							<input type="radio" id="non_adapt" name="stepping_method"onclick="handleClick_A(this);"  value="non_adapt">
							<label for="non_adapt">Non-adaptive</label>
						</div>
					</fieldset>
					<fieldset>
						<legend>Initial step size of control sequence (<i>a</i><sub>0</sub>)</legend>
						<div>
							<input type="radio" id="default_a0" name="a0" onclick="handleClick_a0(this);" value="default" checked>
								
							<label for="default_a0">Optimal (default)</label>
						</div>
						<div>								
							<input type="radio" id="custom_a0" name="a0" onclick="handleClick_a0(this);" value="custom">
							<!--<div id="id="input_a0_box">-->
							<label for="custom_a0">Custom:</label>
							<input type="number" id="a0_custom" name="a0_custom" max="20" min="1" placeholder="6.7" step="0.1" value="6.7" size="4" disabled required>
							% MSO, [1, 20].
						</div>
					</fieldset>
					<p style="font-size:85%;">
						Please refer to the information below for further details on the methods.
					</p>
			</fieldset></td></tr>
			<tr><td><fieldset>
                <legend>Initial (suprathreshold) amplitude</legend>
                <input type="number" id="MT_0" name="MT_0" max="100" min="1" placeholder="50" step="1" value="50" size="4" required>
				% MSO, (0, 100].
			</fieldset></td></tr></table>
			
			<!--
			<p id="start_button">
				
			</p>
			<p id="reset_button" hidden>
				
			</p>
			-->
			
            <p id="Start_msg"><button class="w3-green" id="MT_start" onclick="MT_start();"><u>S</u>tart</button> and move to next section. </p>
			<p id="Reset_msg" hidden><button class="w3-black" id="MT_reset" onclick="MT_reset();"><u>R</u>eset</button> to start a new procedure and/or to change the estimation method.</p>
        </div>

        <div class="w3-container w3-blue">
            <h2>Motor threshold estimate</h2>
        </div>

        <div class="w3-container">
			<p><output id="MT_method"></output></p>
            <p><output id="MT_nextPulse">Start procedure first.</output></p>
			<table><tr><td>
			<fieldset id="is_suprathreshold_bottoms" hidden>
				<legend>TMS response present / suprathreshold?</legend>
				<button class="w3-green" id="MT_MEP" onclick="MT_stimulate(true);"  disabled><u>Y</u>es: present / suprathreshold</button> 
				<button class="w3-red" id="MT_noMEP" onclick="MT_stimulate(false);" disabled><u>N</u>o:  absent  / subthreshold  </button>
			</fieldset>
			<fieldset id="response_Vpp_box" hidden>
				<legend>TMS response</legend>
				<div>
					<label>EMG:</label>
					<input type="number" id="V_pp" name="V_pp" max="1000000" min="0" placeholder="50" step="1" value="50" size="6" required>
					μV<sub>pp</sub>, (0 to 10<sup>6</sup>].
				</div>
				<div>
					<button class="w3-green" id="Enter_Vpp" onclick="MT_stimulate(false);" disabled><u>Enter</u></button>	<!--Dummy input for analog methods-->
				</div>
			</fieldset>
			</td></tr></table>
			<p><output id="MT_estimate"></output>
            <br><output id="MT_estimateDescription"></output></p>
        </div>

        <div class="w3-container w3-light-blue">
            <h3>List of pulses for latest estimation</h3>
        </div>

        <div class="w3-container">
            <p>A read-only list of information from the latest estimation. <br>
			<button class="w3-green" onclick="copyToClipboard()"><u>C</u>opy</button> and save if needed.</p>
            <textarea id="MT_pulseList" rows="2" style="font-size:85%;" readonly></textarea>
            <p></p>
        </div>

        <div class="w3-container w3-blue">
            <h3>Information about this app</h3>
        </div>
		
		<div class="w3-container">
			<p>
				<div>© 2022-2023 Boshuo Wang, Lari Koponen, Stefan Goetz, Angel Peterchev</div>
				<div>version 1.2, 2023 January 18</div>
			</p>
            <p>This HTML/JS application is written by Boshuo Wang and Lari M. Koponen. The stochastic approximation MT methods are described in the following manuscript, which explores the performance for different control sequences, stepping adaptiveness, and initial step size.</p>
			<ul>
				<li>B. Wang, A. V. Peterchev, and S. M. Goetz, “Three Novel Methods for Determining Motor Threshold with Transcranial Magnetic Stimulation Outperform Conventional Procedures”, <i>bioRxiv</i>, Jun. 2022. DOI: <a href="https://doi.org/10.1101/2022.06.26.495134">10.1101/2022.06.26.495134</a>.</li>
			</ul>
			<p>The choice of initial stimulation amplitude close to the MT and the description of the quality of the current estimation follow suggestions in:</p>
			<ul>
				<li>L. M. Koponen and A. V. Peterchev, “Preventing misestimation of transcranial magnetic stimulation motor threshold with MTAT 2.0”, <i>Brain Stimulation: Basic, Translational, and Clinical Research in Neuromodulation</i>, vol. 15, no. 5, pp. 1073–1076, Sep. 2022. DOI: <a href="https://doi.org/10.1016/j.brs.2022.07.057">10.1016/j.brs.2022.07.057</a>.</li>
			</ul>
			<!-- <p>Method for estimation of the probable range or 95% confidence interval of the MT will be described in future publication.<ul><li></li></ul></p> -->
			
			<p></p>
			
			<p>The MT is estimated using a stochastic approximation method with a first-order digital control sequence (DCS1) or analog control sequence (ACS1). The control sequence follows harmonic (H) convergence with or without adaptive (A) stepping.</p>
			<p>For the method to work correctly, it is important to start from an amplitude that is close to the MT and preferably <i>suprathreshold </i> (i.e., an amplitude that produces motor responses, more often than not). The amplitude used to locate the motor hot spot is a good starting point. With a good initial amplitude, the estimator takes 15 pulses to determine the MT.</p>
			<p>All processing is done by the app locally. No data is shared online.</p>
			
			<p> Known limitations and bugs:</p>
            <ul>
                <li>The tool is provided as is. In particular, the description of the quality of the MT estimation is based on an approximate algorithm which may prematurely declare the estimation “good”. The final judgement on the MT must always be made by the operator!</li>
				
				<li>The algorithm may attempt to step to impossible amplitudes for the MT estimate (below 0% or above 100% MSO). This app limits both the MT estimate and the next amplitude on the lower end, whereas only the next amplitude is limited on the upper end, with the MT estimate possibly exceeding 100% MSO.</li>
                
				<li>Copy to clipboard button does not work on some mobile devices. If the copy button tells that it has failed, please copy the text manually.</li>
            </ul>
        </div>
		
    </body>
</html>
